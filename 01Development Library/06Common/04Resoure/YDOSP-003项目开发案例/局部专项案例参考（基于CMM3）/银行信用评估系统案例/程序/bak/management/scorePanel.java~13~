package management;

import java.awt.*;
import javax.swing.*;
import com.borland.dx.sql.dataset.*;
import com.borland.dbswing.*;
import com.borland.dx.dataset.*;
import java.awt.event.*;
import java.sql.*;
import com.borland.jbcl.layout.*;

/**
 * <p>Title: </p>
 * <p>Description: </p>
 * <p>Copyright: Copyright (c) 2004</p>
 * <p>Company: </p>
 * @author not attributable
 * @version 1.0
 */

public class scorePanel extends JPanel {
  JLabel jLabel2 = new JLabel();
  JTextField jTextField1 = new JTextField();
  JButton jButton1 = new JButton();
  JButton jButton2 = new JButton();
  Database database1 = new Database();
  QueryDataSet queryDataSet1 = new QueryDataSet();
  QueryResolver queryResolver1 = new QueryResolver();
  JdbNavToolBar jdbNavToolBar1 = new JdbNavToolBar();
  JdbStatusLabel jdbStatusLabel1 = new JdbStatusLabel();
  TableScrollPane tableScrollPane1 = new TableScrollPane();
  JdbTable jdbTable1 = new JdbTable();
  Column column1 = new Column();
  Column column2 = new Column();
  Column column3 = new Column();
  Column column4 = new Column();
  Column column5 = new Column();
  Column column6 = new Column();
  Column column7 = new Column();
  Column column8 = new Column();
  GridBagLayout gridBagLayout1 = new GridBagLayout();
  PreparedStatement pstmt;
  Connection con;
  String query;
  ResultSet rs;
  String str;
  JLabel jLabel3 = new JLabel();
  String ip;

  public scorePanel() {
    try {
      jbInit();
    }
    catch(Exception ex) {
      ex.printStackTrace();
    }
  }
  public scorePanel(String str) {
    ip=str;
    try {
      jbInit();
    }
    catch(Exception ex) {
      ex.printStackTrace();
    }
  }

  void jbInit() throws Exception {
    this.setLayout(gridBagLayout1);
    jLabel2.setFont(new java.awt.Font("Dialog", 1, 22));
    jLabel2.setForeground(SystemColor.activeCaption);
    jLabel2.setText("输入学号：");
    jTextField1.setText("");
    jButton1.setBackground(new Color(151, 164, 203));
    jButton1.setFont(new java.awt.Font("Dialog", 1, 15));
    jButton1.setText("确定");
    jButton1.addActionListener(new scorePanel_jButton1_actionAdapter(this));
    jButton2.setBackground(new Color(151, 164, 203));
    jButton2.setFont(new java.awt.Font("Dialog", 1, 15));
    jButton2.setText("重置");
    jButton2.addActionListener(new scorePanel_jButton2_actionAdapter(this));
    database1.setConnection(new com.borland.dx.sql.dataset.ConnectionDescriptor("jdbc:microsoft:sqlserver://"+ip+":1433;DatabaseName=student", "sa", "lomf8244", false, "com.microsoft.jdbc.sqlserver.SQLServerDriver"));
    database1.setTransactionIsolation(java.sql.Connection.TRANSACTION_READ_COMMITTED);
    queryDataSet1.setResolver(queryResolver1);
    queryDataSet1.setQuery(new com.borland.dx.sql.dataset.QueryDescriptor(database1, "select * from score", null, true, Load.ALL));
    queryResolver1.setDatabase(database1);
    queryResolver1.setUpdateMode(com.borland.dx.dataset.UpdateMode.KEY_COLUMNS);
    jdbNavToolBar1.setBackground(new Color(217, 223, 236));
    jdbNavToolBar1.setDataSet(queryDataSet1);
    jdbStatusLabel1.setBackground(new Color(217, 230, 236));
    jdbStatusLabel1.setRequestFocusEnabled(true);
    jdbStatusLabel1.setText("");
    jdbStatusLabel1.setDataSet(queryDataSet1);
    tableScrollPane1.getViewport().setBackground(new Color(217, 230, 236));
    tableScrollPane1.setForeground(Color.black);
    jdbTable1.setBackground(Color.cyan);
    jdbTable1.setAutoResizeMode(JTable.AUTO_RESIZE_LAST_COLUMN);
    jdbTable1.setSelectionBackground(SystemColor.info);
    jdbTable1.setSelectionForeground(Color.black);
    jdbTable1.setDataSet(queryDataSet1);
    column1.setCaption("学号");
    column1.setColumnName("STUDENTNO");
    column1.setDataType(com.borland.dx.dataset.Variant.STRING);
    column1.setPrecision(8);
    column1.setRowId(true);
    column1.setTableName("score");
    column1.setServerColumnName("STUDENTNO");
    column1.setSqlType(1);
    column2.setCaption("课程名称");
    column2.setColumnName("COURSENAME");
    column2.setDataType(com.borland.dx.dataset.Variant.STRING);
    column2.setPrecision(10);
    column2.setRowId(true);
    column2.setTableName("score");
    column2.setServerColumnName("COURSENAME");
    column2.setSqlType(12);
    column3.setCaption("成绩");
    column3.setColumnName("SCORE");
    column3.setDataType(com.borland.dx.dataset.Variant.STRING);
    column3.setPrecision(10);
    column3.setTableName("score");
    column3.setServerColumnName("SCORE");
    column3.setSqlType(1);
    column4.setCaption("学分");
    column4.setColumnName("SCORECREDIT");
    column4.setDataType(com.borland.dx.dataset.Variant.STRING);
    column4.setPrecision(10);
    column4.setTableName("score");
    column4.setServerColumnName("SCORECREDIT");
    column4.setSqlType(1);
    column5.setCaption("类别");
    column5.setColumnName("SCORESORT");
    column5.setDataType(com.borland.dx.dataset.Variant.STRING);
    column5.setPrecision(10);
    column5.setTableName("score");
    column5.setServerColumnName("SCORESORT");
    column5.setSqlType(1);
    column6.setCaption("考别");
    column6.setColumnName("SCORETPYE");
    column6.setDataType(com.borland.dx.dataset.Variant.STRING);
    column6.setPrecision(10);
    column6.setTableName("score");
    column6.setServerColumnName("SCORETPYE");
    column6.setSqlType(1);
    column7.setCaption("备注");
    column7.setColumnName("SCOREREMARK");
    column7.setDataType(com.borland.dx.dataset.Variant.STRING);
    column7.setPrecision(10);
    column7.setTableName("score");
    column7.setServerColumnName("SCOREREMARK");
    column7.setSqlType(1);
    column8.setCaption("时间");
    column8.setColumnName("SCORETIME");
    column8.setDataType(com.borland.dx.dataset.Variant.STRING);
    column8.setPrecision(10);
    column8.setTableName("score");
    column8.setServerColumnName("SCORETIME");
    column8.setSqlType(1);
    queryDataSet1.setColumns(new Column[] {column1, column2, column3, column4, column5, column6, column7, column8});
    jLabel3.setBackground(Color.black);
    jLabel3.setFont(new java.awt.Font("Dialog", 1, 40));
    jLabel3.setForeground(SystemColor.activeCaption);
    jLabel3.setText("    学 生 成 绩 管 理");
    this.setBackground(new Color(217, 230, 236));
    this.add(jButton2,   new GridBagConstraints(1, 3, 1, 1, 0.0, 0.0
            ,GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(12, 48, 0, 112), 10, 3));
    this.add(jButton1,   new GridBagConstraints(0, 3, 1, 1, 0.0, 0.0
            ,GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(13, 109, 0, 0), 8, 2));
    this.add(jLabel2,   new GridBagConstraints(0, 2, 1, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(14, 58, 0, 0), 0, 6));
    this.add(jTextField1,   new GridBagConstraints(1, 2, 1, 1, 1.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.HORIZONTAL, new Insets(21, 0, 7, 70), 147, 1));
    this.add(jdbNavToolBar1,   new GridBagConstraints(0, 4, 2, 1, 1.0, 0.0
            ,GridBagConstraints.CENTER, GridBagConstraints.HORIZONTAL, new Insets(0, 0, 0, 0), 33, 0));
    this.add(jdbStatusLabel1,   new GridBagConstraints(0, 5, 2, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(0, 0, 0, 0), 322, 0));
    this.add(tableScrollPane1,   new GridBagConstraints(0, 6, 2, 1, 1.0, 1.0
            ,GridBagConstraints.CENTER, GridBagConstraints.BOTH, new Insets(0, 0, 0, 0), -71, -333));
    this.add(jLabel3,   new GridBagConstraints(0, 0, 2, 2, 0.0, 0.0
            ,GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(0, 0, 0, 0), 189, 13));
    tableScrollPane1.getViewport().add(jdbTable1, null);
    Class.forName("com.microsoft.jdbc.sqlserver.SQLServerDriver");
     String url = "jdbc:microsoft:sqlserver://"+ip+":1433;DatabaseName=student";
     String username= "sa";
     String password= "lomf8244";
     con = DriverManager.getConnection(url,username,password);
     query="select * from student where STUDENTNO=?";
     pstmt = con.prepareStatement(query);
  }

  void jButton1_actionPerformed(ActionEvent e) {
    try{
       str=jTextField1.getText();
       pstmt.setString(1,str);
       rs=pstmt.executeQuery();
       if(rs.next()){
        queryDataSet1.close();
        str=rs.getString("STUDENTNO");
        queryDataSet1.setQuery(new com.borland.dx.sql.dataset.QueryDescriptor(database1, "select * from score where STUDENTNO="+str, null, true, Load.ALL));
        queryDataSet1.refresh();

      jdbNavToolBar1.setDataSet(queryDataSet1);
      jdbStatusLabel1.setDataSet(queryDataSet1);
      jdbTable1.setDataSet(queryDataSet1);
      jdbTable1.repaint();

       }
       else{
         jTextField1.setText("学号不存在!");
         queryDataSet1.close();
         queryDataSet1.refresh();
         jdbTable1.setDataSet(null);
         jdbTable1.repaint();

       }
     }
     catch(Exception ef)
     { System.out.print("系统错误，请重新运行。");
     }
  }

  void jButton2_actionPerformed(ActionEvent e) {
        jTextField1.setText("");
        queryDataSet1.close();
        queryDataSet1.setQuery(new com.borland.dx.sql.dataset.QueryDescriptor(database1, "select * from score", null, true, Load.ALL));
        queryDataSet1.refresh();
        jdbNavToolBar1.setDataSet(queryDataSet1);
        jdbStatusLabel1.setDataSet(queryDataSet1);
        jdbTable1.setDataSet(queryDataSet1);
        jdbTable1.repaint();

  }
}

class scorePanel_jButton1_actionAdapter implements java.awt.event.ActionListener {
  scorePanel adaptee;

  scorePanel_jButton1_actionAdapter(scorePanel adaptee) {
    this.adaptee = adaptee;
  }
  public void actionPerformed(ActionEvent e) {
    adaptee.jButton1_actionPerformed(e);
  }
}

class scorePanel_jButton2_actionAdapter implements java.awt.event.ActionListener {
  scorePanel adaptee;

  scorePanel_jButton2_actionAdapter(scorePanel adaptee) {
    this.adaptee = adaptee;
  }
  public void actionPerformed(ActionEvent e) {
    adaptee.jButton2_actionPerformed(e);
  }
}