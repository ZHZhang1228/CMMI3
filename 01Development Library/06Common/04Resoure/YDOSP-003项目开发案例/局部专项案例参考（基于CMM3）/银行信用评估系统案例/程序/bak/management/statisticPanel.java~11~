package management;

import java.awt.*;
import javax.swing.*;
import com.borland.dbswing.*;
import java.awt.event.*;
import com.borland.jbcl.layout.*;
import com.borland.dx.sql.dataset.*;
import java.awt.event.*;
import java.sql.*;

/**
 * <p>Title: </p>
 * <p>Description: </p>
 * <p>Copyright: Copyright (c) 2004</p>
 * <p>Company: </p>
 * @author not attributable
 * @version 1.0
 */

public class statisticPanel extends JPanel {
  JLabel jLabel1 = new JLabel();
  JComboBox jComboBox1 = new JComboBox();
  JLabel jLabel2 = new JLabel();
  JLabel jLabel3 = new JLabel();
  JLabel jLabel4 = new JLabel();
  TableScrollPane tableScrollPane1 = new TableScrollPane();
  JdbTable jdbTable1 = new JdbTable();
  JButton jButton1 = new JButton();

  PreparedStatement pstmt;
  Connection con;
  String query;
  ResultSet rs;
  String str;
  JLabel jLabel5 = new JLabel();
  Database database1 = new Database();
  QueryDataSet queryDataSet1 = new QueryDataSet();
  QueryResolver queryResolver1 = new QueryResolver();
  GridBagLayout gridBagLayout1 = new GridBagLayout();

  public statisticPanel() {
    try {
      jbInit();
    }
    catch(Exception ex) {
      ex.printStackTrace();
    }
  }
  void jbInit() throws Exception {
    jLabel1.setFont(new java.awt.Font("Dialog", 1, 40));
    jLabel1.setText("   学 生 统 计 管 理");
    this.setLayout(gridBagLayout1);
    jComboBox1.addItemListener(new statisticPanel_jComboBox1_itemAdapter(this));
    jLabel2.setFont(new java.awt.Font("Dialog", 1, 22));
    jLabel2.setToolTipText("");
    jLabel2.setText("   选 择 统 计 项 :");
    this.setBackground(UIManager.getColor("InternalFrame.activeTitleGradient"));
    jLabel3.setBackground(Color.red);
    jLabel3.setFont(new java.awt.Font("Dialog", 1, 15));
    jLabel3.setForeground(Color.red);
    jLabel3.setText("留级标准：未通过课程学分累计达到5分");
    jLabel3.setBounds(new Rectangle(40, 120, 292, 16));
    jLabel4.setFont(new java.awt.Font("Dialog", 1, 15));
    jLabel4.setForeground(Color.red);
    jLabel4.setText("退学标准：未通过课程学分累计达到8分");
    jLabel4.setBounds(new Rectangle(42, 152, 284, 16));
    tableScrollPane1.setBounds(new Rectangle(-1, 177, 494, 268));
    jButton1.setBounds(new Rectangle(367, 148, 66, 19));
    jButton1.setText("统计");
    jdbTable1.setAutoResizeMode(JTable.AUTO_RESIZE_LAST_COLUMN);
    jdbTable1.setDataSet(queryDataSet1);
    jLabel5.setText("jLabel5");
    jLabel5.setBounds(new Rectangle(344, 108, 142, 30));
    database1.setConnection(new com.borland.dx.sql.dataset.ConnectionDescriptor("jdbc:microsoft:sqlserver://localhost:1433;DatabaseName=student", "sa", "lomf8244", false, "com.borland.datastore.jdbc.DataStoreDriver"));
    database1.setTransactionIsolation(java.sql.Connection.TRANSACTION_READ_COMMITTED);
    queryDataSet1.setResolver(queryResolver1);
    queryDataSet1.setQuery(new com.borland.dx.sql.dataset.QueryDescriptor(database1, "select * from score", null, true, Load.ALL));
    queryResolver1.setDatabase(database1);
    queryResolver1.setUpdateMode(com.borland.dx.dataset.UpdateMode.KEY_COLUMNS);
    this.add(jLabel1,  new GridBagConstraints(0, 0, 3, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(7, 48, 0, 59), 26, -12));
    this.add(jComboBox1,  new GridBagConstraints(1, 1, 2, 1, 1.0, 0.0
            ,GridBagConstraints.CENTER, GridBagConstraints.HORIZONTAL, new Insets(16, 25, 0, 32), 207, 4));
    this.add(jLabel2,  new GridBagConstraints(0, 1, 1, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(16, 15, 0, 0), 5, -5));
    this.add(jLabel3,  new GridBagConstraints(0, 2, 2, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(27, 40, 0, 0), 14, -6));
    this.add(jLabel4,  new GridBagConstraints(0, 3, 2, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(16, 42, 0, 6), 6, -6));
    this.add(tableScrollPane1,  new GridBagConstraints(0, 4, 3, 1, 1.0, 1.0
            ,GridBagConstraints.CENTER, GridBagConstraints.BOTH, new Insets(9, -1, 0, 0), 16, -157));
    this.add(jButton1,  new GridBagConstraints(2, 3, 1, 1, 0.0, 0.0
            ,GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(12, 35, 0, 60), 9, -6));
    this.add(jLabel5,  new GridBagConstraints(2, 2, 1, 1, 0.0, 0.0
            ,GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(15, 12, 0, 7), 108, 14));
    tableScrollPane1.getViewport().add(jdbTable1, null);
    jComboBox1.addItem("重修统计");
    jComboBox1.addItem("留级统计");
    jComboBox1.addItem("退学统计");

    Class.forName("com.microsoft.jdbc.sqlserver.SQLServerDriver");
       String url = "jdbc:microsoft:sqlserver://localhost:1433;DatabaseName=student";
       String username= "sa";
       String password= "lomf8244";
       con = DriverManager.getConnection(url,username,password);

  }

  void jComboBox1_itemStateChanged(ItemEvent e) {
      str=(String)jComboBox1.getSelectedItem();
       if(str.equals("重修统计"))
        {
          jLabel5.setText("HELLO");
          str="重修";

      }

  }

  void jButton1_actionPerformed(ActionEvent e) {
    try{
             query="select * from score where SCORETPYE=?";
             pstmt = con.prepareStatement(query);
             pstmt.setString(1,str);
             rs=pstmt.executeQuery();
          if(rs.next()){
             queryDataSet1.close();
              str=rs.getString("SCORETPYE");
             str= "select * from score where SCORETPYE="+"\'"+str+"\'";
              jLabel5.setText(str);
             queryDataSet1.setQuery(new com.borland.dx.sql.dataset.QueryDescriptor(database1, str, null, true, Load.ALL));
             queryDataSet1.refresh();
             jdbTable1.setDataSet(queryDataSet1);
             jdbTable1.repaint();
           }
           else{

                  jLabel5.setText("学号不存在!");
                  queryDataSet1.close();
                  queryDataSet1.refresh();
                  jdbTable1.setDataSet(null);
                  jdbTable1.repaint();

           }
             }
            catch(Exception ef)
            { System.out.print("YES,系统错误，请重新运行。");
            }

/*  try{
    if(rs.next()){
    queryDataSet1.close();
    str=rs.getString("SCORETPYE");
     str= "select * from score where SCORETPYE="+"\'"+str+"\'";
    queryDataSet1.setQuery(new com.borland.dx.sql.dataset.QueryDescriptor(database1, str, null, true, Load.ALL));
    queryDataSet1.refresh();
    jdbTable1.setDataSet(queryDataSet1);
    jdbTable1.repaint();
    }
  else{

 //  jTextField1.setText("学号不存在!");
   queryDataSet1.close();
   queryDataSet1.refresh();
   jdbTable1.setDataSet(null);
   jdbTable1.repaint();
   }
  }

   catch(Exception ef)
  { System.out.print("系统错误，请重新运行。");
  }
        */
  }

}

class statisticPanel_jComboBox1_itemAdapter implements java.awt.event.ItemListener {
  statisticPanel adaptee;

  statisticPanel_jComboBox1_itemAdapter(statisticPanel adaptee) {
    this.adaptee = adaptee;
  }
  public void itemStateChanged(ItemEvent e) {
    adaptee.jComboBox1_itemStateChanged(e);
  }
}

class statisticPanel_jButton1_actionAdapter implements java.awt.event.ActionListener {
  statisticPanel adaptee;

  statisticPanel_jButton1_actionAdapter(statisticPanel adaptee) {
    this.adaptee = adaptee;
  }
  public void actionPerformed(ActionEvent e) {
    adaptee.jButton1_actionPerformed(e);
  }
}